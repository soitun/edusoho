!function(t){function e(e){for(var a,o,s=e[0],c=e[1],l=e[2],u=0,p=[];u<s.length;u++)o=s[u],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&p.push(r[o][0]),r[o]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);for(d&&d(e);p.length;)p.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],a=!0,s=1;s<n.length;s++){var c=n[s];0!==r[c]&&(a=!1)}a&&(i.splice(e--,1),t=o(o.s=n[0]))}return t}var a={},r={211:0},i=[];function o(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=a,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(n,a,function(e){return t[e]}.bind(null,a));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/static-dist/";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var l=0;l<s.length;l++)e(s[l]);var d=c;i.push([1523,0]),n()}({1523:function(t,e,n){"use strict";n.r(e);var a=n(91),r=n.n(a),i=n(50),o=n.n(i),s=n(33),c=n.n(s),l=n(4),d=n.n(l),u=n(5),p=n.n(u),m=(n(344),n(239)),v=(n(510),n(205)),f=(n(408),n(242)),h=(n(104),n(97),n(146)),g="COURSE_BASE_INTRO",y=function(){function t(){d()(this,t),this.intro=null,this.customClass="es-intro-help multistep",this.$intro=$(".js-plan-intro"),this.init()}return p()(t,[{key:"init",value:function(){if(this.$intro.length){var t=$("#s2b2c_enabled").val();store.get(g)||t||(store.set(g,!0),this.introStart(this.initAllSteps()),this.$intro.addClass("hidden")),this.initEvent()}}},{key:"initEvent",value:function(){var t=this;$("body").on("click",".js-skip",(function(e){t.intro.exit(),t.$intro.removeClass("hidden")})),$("body").on("click",".js-plan-intro-btn",(function(e){$("html").scrollTop(0),t.introStart(t.initSingleStep())})),window.addEventListener("scroll",Object(h.a)(this.scrollPosition,100,!0))}},{key:"introStart",value:function(t){var e=this,n='<i class="es-icon es-icon-close01"></i>';this.intro=introJs(),this.customClass=t.length<2?"es-intro-help js-intro-help es-intro-single":"es-intro-help js-intro-help multistep",this.intro.setOptions({steps:t,skipLabel:n,nextLabel:Translator.trans("course_set.manage.next_label"),prevLabel:Translator.trans("course_set.manage.prev_label"),doneLabel:n,showBullets:!1,tooltipPosition:"auto",showStepNumbers:!1,exitOnEsc:!1,exitOnOverlayClick:!1,tooltipClass:this.customClass});var a=this;this.intro.start().onexit((function(){a.$intro.removeClass("hidden")})).onchange((function(){0!==e.intro._currentStep?e.intro.setOptions({tooltipClass:"es-intro-help multistep es-intro-normal-tip"}):e.intro.setOptions({tooltipClass:"es-intro-help multistep"}),console.log(e.intro),e.intro._currentStep==e.intro._introItems.length-1?$(".introjs-nextbutton").before('<a class="introjs-button done-button js-skip">'+Translator.trans("intro.confirm_hint")+"<a/>"):$(".js-skip").remove()})),$(".js-intro-help").parent().css("top","0")}},{key:"scrollPosition",value:function(){var t=$(".js-plan-intro");$(document).scrollTop()>440?t.addClass("course-manage-intro-float"):t.removeClass("course-manage-intro-float")}},{key:"initAllSteps",value:function(){return[{intro:Translator.trans("course_set.manage.img")},{element:"#step-1",intro:Translator.trans("course_set.manage.couseset_tab")},{element:"#step-2",intro:Translator.trans("course_set.manage.single_plan")},{element:"#step-3",intro:Translator.trans("course_set.manage.all_plan")},{element:"#step-4",intro:Translator.trans("course_set.manage.publish_courseset")}]}},{key:"initSingleStep",value:function(){return[{intro:Translator.trans("course_set.manage.img")}]}}]),t}(),_=n(365),x={name:"market-setting",props:{exercise:{}},mounted:function(){window.marketingForm=this.marketingForm,$('[data-toggle="popover"]').popover({html:!0,trigger:"hover"})},watch:{contractEnableSwitch:function(t){t&&this.fetchContracts()},contractPreviewModalVisible:function(t){this.contractMenuVisible=!t}},methods:{fetchContracts:function(){var t=this;this.$axios.get("/api/simple_contract").then((function(e){t.contracts=e.data,0!==t.contracts.length&&0==t.marketingForm.contractId&&(t.marketingForm.contractId=t.contracts[0].id,t.contractName=t.contracts[0].name)}))},selectContract:function(t,e){this.marketingForm.contractId=t,this.contractName=e,this.contractMenuVisible=!1},previewContract:function(t){var e=this;this.$axios.get("/api/contract/".concat(t,"/preview/itemBankExercise_").concat(this.exercise.id)).then((function(t){e.contractPreview=t.data,e.contractPreviewModalVisible=!0}))}},data:function(){var t={contractEnable:0!==this.exercise.contractId?1:0,contractId:this.exercise.contractId,contractForceSign:this.exercise.contractForceSign};return this.fetchContracts(),{contracts:[],contractName:this.exercise.contractName,contractMenuVisible:!1,contractPreviewModalVisible:!1,contractPreview:{},marketingForm:t}},computed:{contractEnableSwitch:{get:function(){return 1===this.marketingForm.contractEnable},set:function(t){this.marketingForm.contractEnable=t?1:0}},contractForceSignSwitch:{get:function(){return 1===this.marketingForm.contractForceSign},set:function(t){this.marketingForm.contractForceSign=t?1:0}}}},b=n(22),w=Object(b.a)(x,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("a-from",[n("a-form-item",{staticStyle:{"margin-bottom":"22px"}},[n("a-col",{staticStyle:{"text-align":"right","padding-right":"20px"},attrs:{span:4}},[n("span",{staticStyle:{"font-size":"14px","font-weight":"bold",color:"rgba(0, 0, 0, 0.56)"}},[t._v("\n          "+t._s(t._f("trans")("course.market_setting.contract"))+"\n          "),n("a-popover",[n("template",{slot:"content"},[n("div",{staticClass:"text-14"},[t._v(t._s(t._f("trans")("course.market_setting.contract.tip")))])]),t._v(" "),n("a-icon",{attrs:{type:"question-circle"}})],2)],1)]),t._v(" "),n("a-col",{attrs:{span:20}},[n("a-switch",{attrs:{id:"contract-enable","active-color":"#46C37B","inactive-color":"#BFBFBF","inline-prompt":""},model:{value:t.contractEnableSwitch,callback:function(e){t.contractEnableSwitch=e},expression:"contractEnableSwitch"}})],1),t._v(" "),n("a-col",{attrs:{span:4}}),t._v(" "),n("a-col",{attrs:{span:20}},[t.contractEnableSwitch?n("div",[n("a-dropdown",{attrs:{trigger:["click"]},model:{value:t.contractMenuVisible,callback:function(e){t.contractMenuVisible=e},expression:"contractMenuVisible"}},[n("a-button",{staticClass:"contract-dropdown-btn"},[n("span",{staticClass:"contract-name"},[t._v(t._s(t.contractName))]),t._v(" "),n("a-icon",{attrs:{type:"down"}})],1),t._v(" "),n("a-menu",{staticClass:"contract-dropdown-menu",attrs:{slot:"overlay"},slot:"overlay"},t._l(t.contracts,(function(e){return n("a-menu-item",{key:e.id},[n("div",{staticClass:"contract-dropdown-menu-item"},[n("span",{staticClass:"contract-dropdown-menu-item-label contract-name",attrs:{title:e.name},on:{click:function(n){return t.selectContract(e.id,e.name)}}},[t._v(t._s(e.name))]),t._v(" "),n("span",{staticClass:"contract-dropdown-menu-item-preview",on:{click:function(n){return t.previewContract(e.id)}}},[t._v(t._s(t._f("trans")("course.market_setting.contract.btn.view")))])])])})),1)],1)],1):t._e()])],1),t._v(" "),t.contractEnableSwitch?n("a-from-item",[n("a-col",{staticStyle:{"text-align":"right","padding-right":"20px","margin-bottom":"22px"},attrs:{span:4}},[n("span",{staticStyle:{"font-size":"14px","font-weight":"bold",color:"rgba(0, 0, 0, 0.56)"}},[t._v("\n            "+t._s(t._f("trans")("course.market_setting.contract.mandatory_signature"))+"\n            "),n("a-popover",[n("template",{slot:"content"},[n("div",{staticClass:"text-14",staticStyle:{width:"400px"}},[t._v(t._s(t._f("trans")("course.market_setting.contract.mandatory_signature.tip")))])]),t._v(" "),n("a-icon",{attrs:{type:"question-circle"}})],2)],1)]),t._v(" "),n("a-col",{staticStyle:{"margin-bottom":"22px"},attrs:{span:20}},[n("a-switch",{attrs:{id:"contract-force-sign","checked-color":"#46C37B","un-checked-color":"#BFBFBF"},model:{value:t.contractForceSignSwitch,callback:function(e){t.contractForceSignSwitch=e},expression:"contractForceSignSwitch"}})],1)],1):t._e()],1),t._v(" "),n("a-modal",{attrs:{width:900,centered:!0,title:t._f("trans")("course.market_setting.contract.model.contractSigning",{name:t.contractPreview.goodsName}),bodyStyle:{height:"fit-content","max-height":"500px",overflow:"auto"}},scopedSlots:t._u([{key:"footer",fn:function(){return[n("div",{staticStyle:{display:"flex","justify-content":"center"}},[n("a-button",{on:{click:function(e){t.contractPreviewModalVisible=!1}}},[t._v(t._s(t._f("trans")("course.market_setting.contract.btn.close"))+"\n        ")])],1)]},proxy:!0}]),model:{value:t.contractPreviewModalVisible,callback:function(e){t.contractPreviewModalVisible=e},expression:"contractPreviewModalVisible"}},[n("div",{staticStyle:{width:"100%",display:"flex","flex-direction":"column",gap:"32px",padding:"32px"}},[n("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"space-between"}},[n("span",{staticStyle:{opacity:"0"}},[t._v(t._s(t._f("trans")("course.market_setting.contract.model.contractNumber"))+t._s(": "+t.contractPreview.code))]),t._v(" "),n("span",{staticStyle:{"font-size":"22px","font-weight":"500"}},[t._v(t._s(t.contractPreview.name))]),t._v(" "),n("span",{staticStyle:{color:"#6b7280"}},[t._v(t._s(t._f("trans")("course.market_setting.contract.model.contractNumber"))+t._s(": "+t.contractPreview.code))])]),t._v(" "),n("div",{staticStyle:{color:"#6b7280","max-width":"100%"},domProps:{innerHTML:t._s(t.contractPreview.content)}}),t._v(" "),n("div",{staticStyle:{display:"flex",gap:"64px"}},[n("div",{staticStyle:{flex:"1",display:"flex","flex-direction":"column","align-items":"flex-start","justify-content":"space-between",gap:"22px"}},[n("span",{staticStyle:{"font-size":"18px","font-weight":"500"}},[t._v(t._s(t._f("trans")("course.market_setting.contract.model.partyA"))+"：")]),t._v(" "),n("div",{staticStyle:{width:"100%",display:"flex","flex-direction":"column",gap:"22px"}},[n("img",{staticStyle:{width:"150px",height:"150px"},attrs:{src:t.contractPreview.seal,alt:""}}),t._v(" "),n("div",{staticStyle:{display:"flex","align-items":"center"}},[n("span",{staticStyle:{color:"#6b7280"}},[t._v(t._s(t._f("trans")("course.market_setting.contract.model.signingDate"))+"：")]),t._v(" "),n("div",{staticStyle:{"flex-grow":"1","border-bottom":"1px solid #d1d5db","font-weight":"500"}},[t._v(t._s(t.contractPreview.signDate)+"\n              ")])])])]),t._v(" "),n("div",{staticStyle:{flex:"1",display:"flex","flex-direction":"column","align-items":"flex-start","justify-content":"space-between"}},[n("span",{staticStyle:{"font-size":"18px","font-weight":"500"}},[t._v(t._s(t._f("trans")("course.market_setting.contract.model.partyB"))+"：")]),t._v(" "),n("div",{staticStyle:{width:"100%",display:"flex","flex-direction":"column",gap:"22px"}},[t.contractPreview.sign&&t.contractPreview.sign.handSignature?n("div",{staticStyle:{display:"flex","align-items":"center"}},[n("span",{staticStyle:{color:"#6b7280"}},[t._v(t._s(t._f("trans")("course.market_setting.contract.model.handSignature"))+"：")]),t._v(" "),n("div",{staticStyle:{"flex-grow":"1","border-bottom":"1px solid #d1d5db","font-weight":"500"}},[n("span",{staticStyle:{opacity:"0"}},[t._v("x")])])]):t._e(),t._v(" "),n("div",{staticStyle:{display:"flex","align-items":"center"}},[n("span",{staticStyle:{color:"#6b7280"}},[t._v(t._s(t._f("trans")("course.market_setting.contract.model.partyBName"))+"：")]),t._v(" "),n("div",{staticStyle:{"flex-grow":"1","border-bottom":"1px solid #d1d5db","font-weight":"500"}},[n("span",{staticStyle:{opacity:"0"}},[t._v("x")])])]),t._v(" "),t.contractPreview.sign&&t.contractPreview.sign.IDNumber?n("div",{staticStyle:{display:"flex","align-items":"center"}},[n("span",{staticStyle:{color:"#6b7280"}},[t._v(t._s(t._f("trans")("course.market_setting.contract.model.iDNumber"))+"：")]),t._v(" "),n("div",{staticStyle:{"flex-grow":"1","border-bottom":"1px solid #d1d5db","font-weight":"500"}},[n("span",{staticStyle:{opacity:"0"}},[t._v("x")])])]):t._e(),t._v(" "),t.contractPreview.sign&&t.contractPreview.sign.phoneNumber?n("div",{staticStyle:{display:"flex","align-items":"center"}},[n("span",{staticStyle:{color:"#6b7280"}},[t._v(t._s(t._f("trans")("course.market_setting.contract.model.contactInformation"))+"：")]),t._v(" "),n("div",{staticStyle:{"flex-grow":"1","border-bottom":"1px solid #d1d5db","font-weight":"500"}},[n("span",{staticStyle:{opacity:"0"}},[t._v("x")])])]):t._e(),t._v(" "),n("div",{staticStyle:{display:"flex","align-items":"center"}},[n("span",{staticStyle:{color:"#6b7280"}},[t._v(t._s(t._f("trans")("course.market_setting.contract.model.signingDate"))+"：")]),t._v(" "),n("div",{staticStyle:{"flex-grow":"1","border-bottom":"1px solid #d1d5db","font-weight":"500"}},[t._v(t._s(t.contractPreview.signDate)+"\n              ")])])])])])])])],1)}),[],!1,null,null,null).exports,k=n(54),S=n(75),C=n.n(S),D=n(121),E=n.n(D),P=C.a.create({headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/vnd.edusoho.v2+json","Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":$("meta[name=csrf-token]").attr("content")}});k.a.prototype.$axios=P,k.a.prototype.$qs=E.a,k.a.use(f.a),k.a.use(v.a),k.a.use(m.a),k.a.filter("trans",(function(t,e){return t?Translator.trans(t,e):""})),new k.a({el:"#contract-setting",render:function(t){return t(w,{props:{exercise:$("#contract-setting").data("exercise")}})}}),new(function(){function t(){d()(this,t),this.initValidator(),this.checkBoxChange(),this.initDatetimepicker(),this.taskPriceSetting(),this.setIntroPosition(),this.expiry=new _.a}return p()(t,[{key:"setIntroPosition",value:function(){var t=$(".js-course-manage-info").offset().left+44;window.onload=function(){$(".js-plan-intro").css("right","".concat(t,"px")).removeClass("hidden")}}},{key:"initDatetimepicker",value:function(){this.initDatePicker("#expiryStartDate"),this.initDatePicker("#expiryEndDate"),this.initDatePicker("#deadline")}},{key:"initValidator",value:function(){var t=$("#course-info-form");this.validator=t.validate({currentDom:"#course-submit",ajax:!0,groups:{date:"expiryStartDate expiryEndDate"},rules:{expiryDays:{required:function(){return"date"!=$('input[name="expiryMode"]:checked').val()},digits:!0,max_year:!0},price:{required:!0,positive_price:!0,min:c()($("#js-course-info").data("minPrice"))},expiryStartDate:{required:function(){return"date"==$('input[name="expiryMode"]:checked').val()},date:!0,before_date:"#expiryEndDate"},expiryEndDate:{required:function(){return"date"==$('input[name="expiryMode"]:checked').val()},date:!0,after_date:"#expiryStartDate"}},messages:{price:Translator.trans($("#js-course-info").data("hintMessage")),expiryDays:{required:Translator.trans("course.manage.deadline_end_date_error_hint")},expiryStartDate:{required:Translator.trans("course.manage.expiry_start_date_error_hint"),before:Translator.trans("course.manage.expiry_days_error_hint")},expiryEndDate:{required:Translator.trans("course.manage.expiry_end_date_error_hint"),after:Translator.trans("course.manage.expiry_start_date_error_hint")}},submitSuccess:function(t){cd.message({type:"success",message:Translator.trans("site.save_success_hint")}),window.location.reload()}}),$.validator.addMethod("before",(function(t,e,n){return"date"!==$('input[name="expiryMode"]:checked').val()||(!t||$(n).val()>t)}),Translator.trans("course.manage.expiry_end_date_error_hint")),$.validator.addMethod("after",(function(t,e,n){return"date"!==$('input[name="expiryMode"]:checked').val()||(!t||$(n).val()<t)}),Translator.trans("course.manage.expiry_start_date_error_hint")),$.validator.addMethod("max_year",(function(t,e){return this.optional(e)||t<=7300}),Translator.trans("course.manage.max_year_error_hint")),this.saveForm()}},{key:"saveForm",value:function(){var t=this;$("#course-submit").on("click",(function(e){e.preventDefault();var n=window.marketingForm,a=$("#course-info-form");a.find('input[name^="marketingForm"]').remove(),o()(n).forEach((function(t){var e=n[t];$("<input>").attr("type","hidden").attr("name","".concat(t)).attr("value",e).appendTo(a)})),t.expiry.commonExpiryMode(),t.validator.form()&&$("#course-info-form").submit()}))}},{key:"initDatePicker",value:function(t){var e=this,n=$(t);n.datetimepicker({format:"yyyy-mm-dd",language:document.documentElement.lang,minView:2,autoclose:!0,endDate:new Date(r()()+31536e7)}).on("hide",(function(){e.validator&&e.validator.element(n)})),n.datetimepicker("setStartDate",new Date)}},{key:"taskPriceSetting",value:function(){var t=$(".js-task-price-setting");t.on("click","li",(function(t){var e=$(t.currentTarget);e.toggleClass("open");var n=e.find("input");n.prop("checked",!n.is(":checked"))})),t.on("click","input",(function(t){t.stopPropagation(),$(t.target).closest("li").toggleClass("open")}))}},{key:"checkBoxChange",value:function(){var t=this;$('input[name="expiryDays"]').on("blur",(function(e){t.validator.element($(e.target))}))}}]),t}()),setTimeout((function(){new y}),500)},365:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var a=n(4),r=n.n(a),i=n(5),o=n.n(i),s=function(){function t(){r()(this,t),this.init()}return o()(t,[{key:"init",value:function(){this.checkBoxChange()}},{key:"checkBoxChange",value:function(){var t=this;$('input[name="deadlineType"]').on("change",(function(e){var n=$("#deadlineType-date"),a=$("#deadlineType-days"),r=$('input[name="deadlineType"]:checked').val();t.removeErrorTip(e),"end_date"===r?(n.removeClass("hidden"),a.addClass("hidden")):(n.addClass("hidden"),a.removeClass("hidden")),t.commonExpiryMode(!0)})),$('input[name="expiryMode"]').on("change",(function(e){var n=$("#expiry-days"),a=$("#expiry-date"),r=$('input[name="expiryMode"]:checked').val();t.removeErrorTip(e);var i=$(".js-expiry-tip");"date"===r?(n.addClass("hidden"),a.removeClass("hidden"),i.removeClass("ml0")):"days"===r?(a.addClass("hidden"),n.removeClass("hidden"),i.removeClass("ml0")):(a.addClass("hidden"),n.addClass("hidden"),i.addClass("ml0")),t.commonExpiryMode(!0)}))}},{key:"commonExpiryMode",value:function(t){var e=this,n=$('[name="deadline"]'),a=$('[name="expiryDays"]'),r=$('[name="expiryStartDate"]'),i=$('[name="expiryEndDate"]'),o=$('[name="deadlineType"]:checked'),s=$('[name="expiryMode"]:checked').val();switch(this.elementRemoveRules(n),this.elementRemoveRules(a),this.elementRemoveRules(r),this.elementRemoveRules(i),s){case"days":if("end_date"===o.val())return void(t?n.on("focus",(function(){e.elementAddRules(n,e.getDeadlineEndDateRules())})):this.elementAddRules(n,this.getDeadlineEndDateRules()));t?a.on("focus",(function(){e.elementAddRules(a,e.getExpiryDaysRules())})):this.elementAddRules(a,this.getExpiryDaysRules());break;case"date":t?(r.on("focus",(function(){e.elementAddRules(r,e.getExpiryStartDateRules())})),i.on("focus",(function(){e.elementAddRules(i,e.getExpiryEndDateRules())}))):(this.elementAddRules(r,this.getExpiryStartDateRules()),this.elementAddRules(i,this.getExpiryEndDateRules()))}}},{key:"removeErrorTip",value:function(t){var e=$(t.target).closest(".form-group");e.removeClass("has-error"),e.find(".js-expiry-input").removeClass("form-control-error"),$(".jq-validate-error").remove()}},{key:"elementRemoveRules",value:function(t){t.rules("remove")}},{key:"elementAddRules",value:function(t,e){t.rules("add",e)}},{key:"getExpiryDaysRules",value:function(){return{required:!0,positive_integer:!0,max_year:!0,messages:{required:Translator.trans(Translator.trans("course.manage.expiry_days_error_hint"))}}}},{key:"getExpiryStartDateRules",value:function(){return{required:!0,date:!0,before_date:"#expiryEndDate",messages:{required:Translator.trans("course.manage.expiry_start_date_error_hint")}}}},{key:"getExpiryEndDateRules",value:function(){return{required:!0,date:!0,after_date:"#expiryStartDate",messages:{required:Translator.trans("course.manage.expiry_end_date_error_hint")}}}},{key:"getDeadlineEndDateRules",value:function(){return{required:!0,date:!0,messages:{required:Translator.trans("course.manage.deadline_end_date_error_hint")}}}}]),t}()}});