!function(e){function t(t){for(var a,r,s=t[0],c=t[1],m=t[2],u=0,d=[];u<s.length;u++)r=s[u],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&d.push(i[r][0]),i[r]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);for(l&&l(t);d.length;)d.shift()();return o.push.apply(o,m||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],a=!0,s=1;s<n.length;s++){var c=n[s];0!==i[c]&&(a=!1)}a&&(o.splice(t--,1),e=r(r.s=n[0]))}return e}var a={},i={144:0},o=[];function r(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=a,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/static-dist/";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var m=0;m<s.length;m++)t(s[m]);var l=c;o.push([1519,0]),n()}({1519:function(e,t,n){"use strict";n.r(t);var a=n(16),i=n.n(a),o=n(25),r=n.n(o),s={data:function(){return{role:$("[name=role]").val(),showCKEditorData:{publicPath:$("[name=ckeditor_path]").val(),filebrowserImageUploadUrl:$("[name=ckeditor_image_upload_url]").val(),filebrowserImageDownloadUrl:$("[name=ckeditor_image_download_url]").val(),language:"zh_CN"===document.documentElement.lang?"zh-cn":document.documentElement.lang,jqueryPath:$("[name=jquery_path]").val()},showAttachment:$("[name=show_attachment]").val(),cdnHost:$("[name=cdn_host]").val(),fileId:0,mediaType:$("[name=media_type]").val(),finishType:$("[name=finishType]").val(),activity:{},submitList:[],isDownload:"1"===JSON.parse($("[name=question_bank_attachment_setting]").val()).enable}},created:function(){var e=this;$.ajax({url:"/api/answer_record/"+$("[name='answer_record_id']").val(),type:"GET",async:!1,headers:{Accept:"application/vnd.edusoho.v2+json"},beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",$("meta[name=csrf-token]").attr("content")),e.setRequestHeader("X-Requested-With","XMLHttpRequest")}}).done((function(t){e.activity=t.activity,e.metaActivity=t.metaActivity,e.answerRecord=t.answer_record,"finished"!=e.answerRecord.status?(e.assessment=t.assessment,e.answerReport=t.answer_report,e.answerScene=t.answer_scene):location.href=$("[name=success_goto_url]").val()})),this.getAnswerRecord()},provide:function(){return{modeOrigin:"do"}},methods:{getReviewData:function(e){$.ajax({url:$("[name='answer_engine_review_url']").val(),contentType:"application/json;charset=utf-8",type:"post",data:r()(e),beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",$("meta[name=csrf-token]").attr("content"))}}).done((function(e){location.href=$("[name=success_goto_url]").val()}))},getReviewDataAagin:function(e){$.ajax({url:$("[name='answer_engine_review_url']").val(),contentType:"application/json;charset=utf-8",type:"post",data:r()(e),beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",$("meta[name=csrf-token]").attr("content"))}}).done((function(e){location.href=$("[name=success_continue_goto_url]").val()}))},deleteAttachment:function(e,t){t&&(this.fileId=e)},previewAttachment:function(e){this.fileId=e},downloadAttachment:function(e){this.fileId=e},previewAttachmentCallback:function(){var e=this,t=this;return new i.a((function(n){$.ajax({url:$("[name=preview-attachment-url]").val(),type:"post",data:{id:e.fileId},beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",$("meta[name=csrf-token]").attr("content"))}}).done((function(e){console.log(app),console.log(e),e.data.sdkBaseUri=app.cloudSdkBaseUri,e.data.disableDataUpload=app.cloudDisableLogReport,e.data.disableSentry=app.cloudDisableLogReport,n(e),t.fileId=0}))}))},downloadAttachmentCallback:function(){var e=this,t=this;return new i.a((function(n){$.ajax({url:$("[name=download-attachment-url]").val(),type:"post",data:{id:e.fileId},beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",$("meta[name=csrf-token]").attr("content"))}}).done((function(e){n(e),t.fileId=0}))}))},deleteAttachmentCallback:function(){var e=this,t=this;return new i.a((function(n){$.ajax({url:$("[name=delete-attachment-url]").val(),type:"post",data:{id:e.fileId},beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",$("meta[name=csrf-token]").attr("content"))}}).done((function(e){n(e),t.fileId=0}))}))},getAnswerRecord:function(){var e=this,t=$("[name='answer_record_id']").val();$.ajax({url:"/api/answerRecord/".concat(t,"/submitList"),type:"GET",headers:{Accept:"application/vnd.edusoho.v2+json"},beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",$("meta[name=csrf-token]").attr("content")),e.setRequestHeader("X-Requested-With","XMLHttpRequest")}}).done((function(t){e.submitList=t}))},handleViewHistoricalResult:function(e){window.open("/homework/result/".concat(e.answer_record_id,"/show?action=check"))},handleCancel:function(){location.href=$("[name=goto_back_url]").val()}}},c=n(22),m=Object(c.a)(s,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"ibs-vue",attrs:{id:"app"}},[n("item-review",{attrs:{role:e.role,activity:e.activity,isDownload:e.isDownload,metaActivity:e.metaActivity,assessment:e.assessment,answerReport:e.answerReport,answerRecord:e.answerRecord,answerScene:e.answerScene,showCKEditorData:e.showCKEditorData,showAttachment:e.showAttachment,cdnHost:e.cdnHost,previewAttachmentCallback:e.previewAttachmentCallback,downloadAttachmentCallback:e.downloadAttachmentCallback,"media-type":e.mediaType,"finish-type":e.finishType,"submit-list":e.submitList},on:{cancel:e.handleCancel,previewAttachment:e.previewAttachment,downloadAttachment:e.downloadAttachment,getReviewData:e.getReviewData,getReviewDataAagin:e.getReviewDataAagin,"view-historical-result":e.handleViewHistoricalResult}})],1)}),[],!1,null,null,null).exports,l=n(15),u=n.n(l),d=n(31),f=n.n(d),h=n(43),v={name:"item-review",components:{itemEngine:n(162).a},mixins:[h.a],data:function(){return{formLayout:"horizontal",reviewForm:this.$form.createForm(this,{name:"essay-comment-form",onValuesChange:this.onValuesChange}),commentScore:0,objectiveScore:0,subjectiveScore:0,form:this.$form.createForm(this,{name:"comments-form"}),visible:!1,comments:[this.t("itemReview.comments_0"),this.t("itemReview.comments_1"),this.t("itemReview.comments_2"),this.t("itemReview.comments_3"),this.t("itemReview.comments_4"),this.t("itemReview.comments_5")],comment:"",grades:["excellent","good","passed","unpassed"],gradeObj:{excellent:this.t("itemReview.rank_0"),good:this.t("itemReview.rank_1"),passed:this.t("itemReview.rank_2"),unpassed:this.t("itemReview.rank_3")},commentData:{},data:{}}},computed:{gradeDefault:function(){return Number(this.answerScene.need_score)?"":"passed"},getObjectiveScore:function(){var e=this.answerReport.objective_score||0;return this.objectiveScore+Number(e)},getSubjectiveScore:function(){var e=this.answerReport.subjective_score||0;return(this.subjectiveScore+Number(e)).toFixed(2)},getCommentScore:function(){var e=this.answerReport.score||0;return(this.commentScore+Number(e)).toFixed(2)},isPassed:function(){return this.getCommentScore>=this.answerScene.pass_score}},props:{activity:{type:Object,default:function(){return{}}},metaActivity:{type:Object,default:function(){return{}}},answerReport:{type:Object,default:function(){return{}}},showCKEditorData:{type:Object,default:function(){return{}}},assessment:{type:Object,default:function(){return{}}},answerScene:{type:Object,default:function(){return{}}},answerRecord:{type:Object,default:function(){return{}}},cdnHost:{type:String,default:"service-cdn.qiqiuyun.net"},previewAttachmentCallback:{type:Function,default:function(){return new i.a((function(e){e()}))}},downloadAttachmentCallback:{type:Function,default:function(){return new i.a((function(e){e()}))}},role:{type:String,default:""},mediaType:{type:String,default:""},finishType:{type:String,default:""},submitList:{type:Array,default:function(){return[]}},isDownload:{type:Boolean,default:!1}},created:function(){this.$on("handleSubmit",this.handleSubmit)},mounted:function(){"testpaper"===this.mediaType&&this.initComment()},methods:{handleSubmit:function(){var e=this;this.reviewForm.validateFields((function(t,n){if(t)e.$message.error(e.t("itemEngine.reviewErrorTips"));else{var a=[];for(var i in n)i.indexOf("score")>-1?a.push(i.slice(5)):i.indexOf("status")>-1&&a.push(i.slice(6));var o=[];for(var r in e.commentScore&&(e.commentScore=0),a){var s={};s.id=a[r],s.score=Number(n["score".concat(a[r])]),s.status=n["status".concat(a[r])],e.commentScore+=Number(n["score".concat(a[r])]),s.comment=n["comment".concat(a[r])],o.push(s)}e.data.report_id=e.answerReport.id,e.data.question_reports=o,e.handleValidateSuccess()}console.log(t)}))},onValuesChange:function(e,t){var n=this,a="";for(var i in t){if(!(i.indexOf("score")>-1))return;a=i}this.reviewForm.validateFields((function(e,i){i[a]=t[a];var o=[];for(var r in i)r.indexOf("score")>-1&&o.push(r.slice(5));for(var s in n.commentScore&&(n.commentScore=0),n.subjectiveScore&&(n.subjectiveScore=0),n.objectiveScore&&(n.objectiveScore=0),o){var c=o[s],m=Number(i["score".concat(c)]);"rich_text"===i["mode".concat(c)]?n.subjectiveScore+=m:n.objectiveScore+=m,n.commentScore+=m}"testpaper"===n.mediaType&&n.initComment()}))},initComment:function(){for(var e=this.activity.customComments,t=this.getCommentScore,n=0;n<e.length;n++){var a=e[n],i=a.start,o=a.end,r=a.comment;if(t>=i&&t<=o){this.form.setFieldsValue(f()({},"comment",r));break}}},handleValidateSuccess:function(){"student"!==this.role?this.visible=!0:this.$emit("getReviewData",this.data)},handleCancel:function(){this.$emit("cancel")},handleChange:function(e){this.comment=e,this.form.setFieldsValue(f()({},"comment",this.comment))},showConfirm:function(e,t){var n=this;this.$confirm({title:n.t("itemReview.ConfirmationPrompt"),okText:n.t("itemReview.Confirm"),cancelText:n.t("itemReview.Cancel"),onOk:function(){"again"===e?n.handleFormSubmitAgain(t):n.handleFormSubmit(t),n.forceRemoveModalDom()},onCancel:function(){n.forceRemoveModalDom()}})},forceRemoveModalDom:function(){var e=document.querySelector(".ant-modal-root");e&&e.remove(),document.body.style=""},handleFormSubmit:function(e){this.getFormData(e),this.$emit("getReviewData",this.data)},handleFormSubmitAgain:function(e){this.getFormData(e),this.$emit("getReviewDataAagin",this.data)},getFormData:function(e){var t=this;this.handleSubmit(),e.preventDefault(),this.form.validateFields((function(e,n){t.commentData=n})),this.visible=!1,this.data=u()(this.data,this.commentData)},getContainer:function(){return document.getElementById("item-bank-sdk-message")},getPopupContainer:function(){return document.getElementById("ibs-review-modal")},previewAttachment:function(e){this.$emit("previewAttachment",e)},downloadAttachment:function(e){this.$emit("downloadAttachment",e)},handleViewHistoricalResult:function(e){this.$emit("view-historical-result",e)}}},p=Object(c.a)(v,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("a-form",{attrs:{form:e.reviewForm}},[n("item-engine",{attrs:{mode:"review",answerReport:e.answerReport,assessment:e.assessment,metaActivity:e.metaActivity,form:e.reviewForm,role:e.role,isDownload:e.isDownload,answerScene:e.answerScene,answerRecord:e.answerRecord,showCKEditorData:e.showCKEditorData,previewAttachmentCallback:e.previewAttachmentCallback,downloadAttachmentCallback:e.downloadAttachmentCallback,cdnHost:e.cdnHost,"media-type":e.mediaType,"finish-type":e.finishType,"submit-list":e.submitList},on:{previewAttachment:e.previewAttachment,downloadAttachment:e.downloadAttachment,"view-historical-result":e.handleViewHistoricalResult},scopedSlots:e._u([{key:"review-footer",fn:function(){return[["testpaper","homework"].includes(e.mediaType)?n("div",{staticClass:"ibs-item-list"},[n("div",{staticClass:"ibs-pl16 ibs-pr16 ibs-comment"},[n("a-row",[n("a-col",{staticClass:"ibs-comment__title ibs-pl16",attrs:{span:3}},[e._v("\n                "+e._s(e.t("itemReview.job_comments"))+"\n              ")]),e._v(" "),n("a-col",{staticClass:"ibs-comment__content",attrs:{span:21}},[n("a-form",{attrs:{form:e.form}},[n("a-form-item",[n("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["comment",{initialValue:""}],expression:"[`comment`, { initialValue: '' }]"}],attrs:{placeholder:e.t("itemReview.InputComment_tip"),rows:5}})],1),e._v(" "),n("a-form-item",[n("a-select",{attrs:{defaultValue:e.comments[0]},on:{change:e.handleChange}},e._l(e.comments,(function(t,a){return n("a-select-option",{key:a,attrs:{value:t}},[e._v("\n                        "+e._s(t)+"\n                      ")])})),1)],1)],1)],1)],1)],1)]):e._e(),e._v(" "),n("div",{staticClass:"ibs-item-list ibs-footer ibs-clearfix",class:{"ibs-footer--right":"homework"===e.mediaType&&"submit"===e.finishType}},["homework"===e.mediaType&&"submit"===e.finishType&&"student"!==e.role?n("span",{staticClass:"ibs-mr24"},[e._v("\n            "+e._s(e.t("itemReview.rightQuestionCount"))+"\n            "+e._s(e.answerReport.right_question_count)+"\n          ")]):"student"!==e.role?[n("div",{staticClass:"ibs-mr24 ibs-left"},[e._v("\n              "+e._s(e.t("itemReview.subjective_question"))+"\n              "+e._s(e.getSubjectiveScore)+"\n              "+e._s(e.t("itemEngine.score"))+"\n            ")]),e._v(" "),n("div",{staticClass:"ibs-mr24 ibs-left"},[e._v("\n              "+e._s(e.t("itemReview.objective_question"))+"\n              "+e._s(e.getObjectiveScore)+"\n              "+e._s(e.t("itemEngine.score"))+"\n            ")]),e._v(" "),n("div",{staticClass:"ibs-mr24 ibs-left"},[e._v("\n              "+e._s(e.t("itemReview.Student_score"))+"：\n              "+e._s(e.getCommentScore)+"\n            ")]),e._v(" "),n("div",{staticClass:"ibs-mr24 ibs-left"},[e._v("\n              "+e._s(e.t("itemReview.Pass_score"))+e._s(e.answerScene.pass_score)+"\n            ")]),e._v(" "),n("div",{staticClass:"ibs-mr24 ibs-left"},[e._v("\n              "+e._s(e.t("itemReview.result"))+"\n              "),e.isPassed?n("span",{staticStyle:{"font-weight":"500",color:"green"}},[e._v("\n                "+e._s(e.t("itemReview.pass"))+"\n              ")]):n("span",{staticStyle:{"font-weight":"500",color:"red"}},[e._v("\n                "+e._s(e.t("itemReview.fail"))+"\n              ")])])]:e._e(),e._v(" "),n("a-button",{staticClass:"ibs-mr24",on:{click:e.handleCancel}},[e._v("\n            "+e._s(e.t("itemReview.Cancel"))+"\n          ")]),e._v(" "),n("a-button",{staticClass:"ibs-mr24",attrs:{type:"primary"},on:{click:function(t){return e.showConfirm("",t)}}},[e._v("\n            "+e._s(e.t("itemReview.FinishReview"))+"\n          ")]),e._v(" "),n("a-button",{on:{click:function(t){return e.showConfirm("again",t)}}},[e._v("\n            "+e._s(e.t("itemReview.FinishThenGo"))+"\n          ")])],2)]},proxy:!0}])})],1)],1)}),[],!1,null,null,null).exports;jQuery.support.cors=!0,Vue.config.productionTip=!1,Vue.component(p.name,p),new Vue({render:function(e){return e(m)}}).$mount("#app")}});